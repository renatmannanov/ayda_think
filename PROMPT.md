ЗАДАЧА: Создать Telegram-бота для сохранения заметок в Google Sheets (Multi-tenant)
ЦЕЛЬ MVP: Рабочая связка "пользователь подключил таблицу -> пишет в боте -> сохраняется в ЕГО таблице"
ТЕХНОЛОГИЧЕСКИЙ СТЕК:

Python 3.9+
aiogram
gspread + google-auth для работы с Google Sheets
python-dotenv для управления ключами

АРХИТЕКТУРА:
project/
├── .env                 # TELEGRAM_BOT_TOKEN, GOOGLE_SHEETS_CREDENTIALS
├── .gitignore
├── requirements.txt
├── config.py           # загрузка переменных окружения
├── users.json          # [NEW] БД пользователей: {user_id: spreadsheet_id}
├── storage/
│   ├── __init__.py
│   ├── base.py        # абстрактный класс
│   └── google_sheets.py # логика записи (принимает spreadsheet_id)
├── bot/
│   ├── __init__.py
│   ├── handlers.py    # логика регистрации и сохранения
│   └── utils.py       # [NEW] хелперы для работы с users.json
└── main.py

ПОШАГОВЫЙ ПЛАН РЕАЛИЗАЦИИ:
ШАГ 1: Настройка окружения (Выполнено)

ШАГ 2: Настроить Google Sheets API (Выполнено частично)
Создать Service Account (один на всех).
Включить API.

ШАГ 3: Реализовать storage/base.py

ШАГ 4: Реализовать storage/google_sheets.py
Метод save_note() теперь должен принимать spreadsheet_id динамически.

ШАГ 5: Реализовать управление пользователями (bot/utils.py)
Функции load_users(), save_user(user_id, spreadsheet_id), get_user_spreadsheet(user_id).
Храним в users.json.

ШАГ 6: Реализовать bot/handlers.py
Команда /start: Приветствие, инструкция "Создай таблицу, добавь бота (email), пришли ссылку".
Обработка ссылки на таблицу:
1. Парсим ID таблицы.
2. Проверяем доступ (пробуем прочитать/записать).
3. Если ок -> сохраняем в users.json.
Обработка текста/reply:
1. Проверяем, есть ли user_id в users.json.
2. Если нет -> просим зарегистрироваться.
3. Если есть -> берем spreadsheet_id и сохраняем заметку.

ШАГ 7: Реализовать main.py

ШАГ 8: Тестирование
Два разных пользователя Telegram.
Две разные таблицы.
Проверить, что заметки попадают в правильные таблицы.

ВАЖНЫЕ ПРИНЦИПЫ:
Минимум сложности - users.json вместо БД.
Приватность - каждый пользователь видит только свои данные (в своей таблице).
Обработка ошибок - если бот потерял доступ к таблице, сообщить пользователю.

ПОДСКАЗКИ ПО РЕАЛИЗАЦИИ:
Для парсинга ID таблицы из ссылки используй регулярку.
В users.json хранить просто JSON-объект.

ДОПОЛНИТЕЛЬНАЯ ЗАДАЧА:
1. создай файл AI_SETTINGS.md
2. запиши туда все настройки, которые получил и сформировал из этого PROMPT'а
3. пополняй и изменяй этот файл постоянно, добавляя новые настройки, которые будут появляться
4. всегда следуй этим настройкам
5. если будут появляться противоречия в настройках, то предупреди меня и предлагай варианты решения.